# 工业协议网关系统 - 服务端客户端分离架构

## 项目概述

这是一个基于C#和.NET 6的工业协议网关系统，采用服务端-客户端分离架构设计。系统提供工业协议管理和OPC UA服务器功能，支持多种工业协议的数据采集和转换，并通过OPC UA协议提供标准化的数据访问接口。

## 架构设计

系统采用以下分层架构：

1. **BYWG.Contracts**：定义服务端和客户端之间的通信接口和数据契约，基于gRPC。
2. **BYWG.Server.Core**：实现核心业务逻辑，包括协议管理和OPC UA服务器功能。
3. **BYWG.Server**：服务端应用程序，负责提供gRPC服务，支持作为Windows服务运行。
4. **BYWG.Client.Core**：客户端核心逻辑，提供与服务端通信的封装和代理。
5. **BYWG.Client**：WPF客户端应用程序，提供用户界面，实现与服务端的交互。

## 功能特性

1. **工业协议管理**
   - 添加、删除、启动和停止工业协议
   - 支持多种工业协议类型
   - 协议参数配置

2. **OPC UA服务器**
   - 启动/停止OPC UA服务器
   - 节点管理（添加、删除、读写）
   - 服务器状态监控

3. **服务端-客户端通信**
   - 基于gRPC的高性能通信
   - 实时状态更新
   - 错误处理和日志记录

## 技术栈

- .NET 6
- C# 10
- gRPC（服务端-客户端通信）
- WPF（客户端UI）
- Google.Protobuf（序列化）
- Microsoft.Extensions.Hosting（依赖注入、配置、日志）
- ASP.NET Core（服务端宿主）

## 快速开始

### 前提条件

- 安装.NET 6 SDK
- 安装Visual Studio 2022或更高版本（推荐）

### 构建项目

1. 打开解决方案文件 `BYWG.Architected.sln`
2. 在Visual Studio中构建整个解决方案

### 运行服务端

有两种方式运行服务端：

1. **作为控制台应用运行**
   - 右键点击`BYWG.Server`项目
   - 选择"设为启动项目"
   - 按F5运行

2. **作为Windows服务安装**
   - 使用管理员权限打开命令提示符
   - 导航到`BYWG.Server`项目的发布目录
   - 运行以下命令安装服务：
     ```
     sc create "Industrial Protocol Gateway" binPath="[发布目录路径]\BYWG.Server.exe"
     sc start "Industrial Protocol Gateway"
     ```
   - 卸载服务：
     ```
     sc stop "Industrial Protocol Gateway"
     sc delete "Industrial Protocol Gateway"
     ```

### 运行客户端

1. 右键点击`BYWG.Client`项目
2. 选择"设为启动项目"
3. 按F5运行
4. 在客户端界面输入服务端地址（默认为`http://localhost:5000`）
5. 点击"连接"按钮连接到服务端

## 配置说明

### 服务端配置

服务端配置文件位于`BYWG.Server`项目中的`appsettings.json`，可以配置以下选项：

- 监听地址和端口
- 日志级别
- OPC UA服务器默认配置
- 工业协议默认参数

### 客户端配置

客户端配置文件位于`BYWG.Client`项目中的`appsettings.json`，可以配置以下选项：

- 默认服务端地址
- 日志级别
- UI主题配置

## 使用指南

### 连接服务端

1. 在客户端主窗口顶部的文本框中输入服务端地址
2. 点击"连接"按钮
3. 连接成功后，状态栏会显示"已连接"，并且各种功能按钮会变为可用状态

### 管理OPC UA服务器

1. 点击"启动"按钮启动OPC UA服务器
2. 点击"停止"按钮停止OPC UA服务器
3. 服务器状态会实时显示在界面上

### 管理工业协议

1. 点击"添加"按钮添加新的工业协议
2. 在弹出的对话框中填写协议名称、选择协议类型、输入连接字符串和配置参数
3. 点击"确定"按钮添加协议
4. 在协议列表中选择协议后，可以进行删除、启动和停止操作
5. 点击"刷新"按钮更新协议列表

### 管理OPC UA节点

1. 点击"添加"按钮添加新的OPC UA节点
2. 在弹出的对话框中填写节点ID、显示名称、选择数据类型和初始值
3. 点击"确定"按钮添加节点
4. 在节点列表中选择节点后，可以进行删除和读写操作
5. 点击"刷新"按钮更新节点列表

## 开发说明

### 添加新的工业协议

1. 在`BYWG.Contracts`项目的`ProtocolType`枚举中添加新的协议类型
2. 在`BYWG.Server.Core`项目中实现相应的协议处理逻辑
3. 更新`ProtocolManagerService`以支持新的协议类型

### 扩展OPC UA功能

1. 在`BYWG.Contracts`项目中定义新的gRPC服务接口
2. 在`BYWG.Server.Core`项目的`OpcUaServiceImpl`中实现新功能
3. 在`BYWG.Client.Core`项目的`ClientServiceProxy`中添加客户端代理方法
4. 在`BYWG.Client`项目的UI中添加相应的交互元素

## 故障排除

1. **连接失败**
   - 检查服务端是否正在运行
   - 确认服务端地址和端口是否正确
   - 检查网络连接和防火墙设置

2. **协议启动失败**
   - 检查协议连接参数是否正确
   - 确认目标设备是否可达
   - 查看服务端日志获取详细错误信息

3. **OPC UA服务器启动失败**
   - 检查端口是否被占用
   - 确认当前用户是否有足够的权限

## 许可协议

[在此添加许可协议信息]